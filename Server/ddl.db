CREATE DATABASE canteen2;

USE canteen2;

CREATE TABLE customer(
  customer_id INT AUTO_INCREMENT,
  first_name VARCHAR(50) NOT NULL,
  middle_name VARCHAR(50) NOT NULL,
  last_name VARCHAR(50) NOT NULL,
  password VARCHAR(100) NOT NULL,
  contact_no NUMERIC(10),
  mail_id VARCHAR(50) NOT NULL,
  dept_name ENUM('Computer','Electronic','Mechanical'),
  deluxe BOOLEAN,
  PRIMARY KEY(customer_id)
);

CREATE TABLE items(
  item_id INT AUTO_INCREMENT,
  name VARCHAR(30) NOT NULL,
  image BLOB,
  price INT NOT NULL,
  description TEXT,
  PRIMARY KEY(item_id)
);

CREATE TABLE past_orders(
  order_id VARCHAR(256),
  customer_id INT NOT NULL,
  bill INT NOT NULL,
  order_status ENUM('Complete', 'Placed', 'Delievered', 'Preparing') NOT NULL,
  placing_time DATETIME NOT NULL,
  completion_time DATETIME NOT NULL,
  otp NUMERIC(6) NOT NULL,
  suggestion TEXT NOT NULL,
  payment ENUM('CoD', 'Online') NOT NULL,
  transaction_id VARCHAR(50),
  PRIMARY KEY(order_id),
  CONSTRAINT fk_customer3 
  FOREIGN KEY (customer_id)  
  REFERENCES customer(customer_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE
);

CREATE TABLE past_ordered_items(
  order_id VARCHAR(256) NOT NULL,
  item_id INT NOT NULL,
  price INT,
  quantity INT,
  CONSTRAINT fk_order1
  FOREIGN KEY (order_id)  
  REFERENCES past_orders(order_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE,
  CONSTRAINT fk_item1
  FOREIGN KEY (item_id)  
  REFERENCES items(item_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE
);

CREATE TABLE live_orders(
  order_id VARCHAR(256),
  customer_id INT NOT NULL,
  bill INT NOT NULL,
  order_status ENUM('Complete', 'Placed', 'Delievered', 'Preparing') NOT NULL,
  placing_time DATETIME NOT NULL,
  otp NUMERIC(6) NOT NULL,
  suggestion TEXT NOT NULL,
  payment ENUM('CoD', 'Online') NOT NULL,
  transaction_id VARCHAR(50),
  PRIMARY KEY(order_id),
  CONSTRAINT fk_customer4  
  FOREIGN KEY (customer_id)  
  REFERENCES customer(customer_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE
);

CREATE TABLE live_ordered_items(
  order_id VARCHAR(256) NOT NULL,
  item_id INT NOT NULL,
  price INT NOT NULL,
  quantity INT NOT NULL,
  CONSTRAINT fk_order2
  FOREIGN KEY (order_id)  
  REFERENCES live_orders(order_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE,
  CONSTRAINT fk_item2
  FOREIGN KEY (item_id)  
  REFERENCES items(item_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE
);

CREATE TABLE menu(
  item_id INT NOT NULL,
  price INT NOT NULL,
  CONSTRAINT fk_item3
  FOREIGN KEY (item_id)  
  REFERENCES items(item_id)  
  ON DELETE CASCADE
  ON UPDATE CASCADE,
  PRIMARY KEY(item_id)
);